# Тесты для config_reader

Этот каталог содержит тесты для модуля `config_reader.c`.

## Структура

```
tests/daemon/config/
├── test_config_reader.c  # Основной тестовый файл
├── Makefile              # Сборка и запуск тестов
└── README.md             # Этот файл
```

## Запуск тестов

### Способ 1: Через Makefile (рекомендуется)

```bash
cd tests/daemon/config
make test
```

или просто:

```bash
make
```

### Способ 2: Вручную

```bash
cd tests/daemon/config

# Компиляция
gcc -Wall -Wextra -g -I../../../daemon/config \
    -c ../../../daemon/config/config_reader.c -o config_reader.o

gcc -Wall -Wextra -g -I../../../daemon/config \
    test_config_reader.c config_reader.o -o test_config_reader

# Запуск
./test_config_reader
```

## Что тестируется

### Функция `get_github_token()`
- ✅ Загрузка токена из переменной окружения
- ✅ Загрузка токена из JSON (когда env нет)
- ✅ Приоритет: env > json
- ✅ Обработка ошибки при отсутствии токена

### Функция `load_config()`
- ✅ Загрузка конфига с переменной окружения
- ✅ Обработка ошибки без переменной окружения

### Функция `free_config()`
- ✅ Корректное освобождение памяти
- ✅ Безопасная обработка NULL

### Управление памятью
- ✅ Корректное выделение памяти
- ✅ Отсутствие утечек памяти
- ✅ Независимые копии данных

## Очистка

Удалить скомпилированные файлы:

```bash
make clean
```

## Добавление новых тестов

Добавьте новую функцию теста в `test_config_reader.c`:

```c
void test_new_feature() {
    printf("\n=== Тест: Новый функционал ===\n");
    
    // Ваш тест
    TEST_ASSERT(condition, "Описание проверки");
}
```

И вызовите её в `main()`.

## Примечания

- Тесты используют `setenv()` и `unsetenv()` для управления переменными окружения
- Все тесты изолированы и не влияют друг на друга
- После каждого теста переменные окружения очищаются





